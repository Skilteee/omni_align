# after_ft_hr_02 = """
# Layer 0: Inter-class distance = 0.1810, Intra-class distance = 0.1954, Separability ratio = 0.9266
# Layer 1: Inter-class distance = 0.3218, Intra-class distance = 0.3354, Separability ratio = 0.9595
# Layer 2: Inter-class distance = 0.5473, Intra-class distance = 0.5806, Separability ratio = 0.9426
# Layer 3: Inter-class distance = 1.1714, Intra-class distance = 1.0703, Separability ratio = 1.0945
# Layer 4: Inter-class distance = 1.4584, Intra-class distance = 1.3832, Separability ratio = 1.0543
# Layer 5: Inter-class distance = 2.0354, Intra-class distance = 1.9660, Separability ratio = 1.0353
# Layer 6: Inter-class distance = 2.1854, Intra-class distance = 2.1612, Separability ratio = 1.0112
# Layer 7: Inter-class distance = 2.4474, Intra-class distance = 2.4654, Separability ratio = 0.9927
# Layer 8: Inter-class distance = 2.7963, Intra-class distance = 2.7755, Separability ratio = 1.0075
# Layer 9: Inter-class distance = 3.8865, Intra-class distance = 3.7937, Separability ratio = 1.0245
# Layer 10: Inter-class distance = 5.2928, Intra-class distance = 4.3253, Separability ratio = 1.2237
# Layer 11: Inter-class distance = 6.7379, Intra-class distance = 5.3757, Separability ratio = 1.2534
# Layer 12: Inter-class distance = 8.5557, Intra-class distance = 6.2924, Separability ratio = 1.3597
# Layer 13: Inter-class distance = 12.2110, Intra-class distance = 7.5222, Separability ratio = 1.6233
# Layer 14: Inter-class distance = 14.0583, Intra-class distance = 9.3396, Separability ratio = 1.5052
# Layer 15: Inter-class distance = 16.8551, Intra-class distance = 10.7470, Separability ratio = 1.5684
# Layer 16: Inter-class distance = 20.3491, Intra-class distance = 12.5330, Separability ratio = 1.6236
# Layer 17: Inter-class distance = 22.5854, Intra-class distance = 13.6913, Separability ratio = 1.6496
# Layer 18: Inter-class distance = 25.2046, Intra-class distance = 15.2901, Separability ratio = 1.6484
# Layer 19: Inter-class distance = 27.5435, Intra-class distance = 16.4854, Separability ratio = 1.6708
# Layer 20: Inter-class distance = 30.5465, Intra-class distance = 17.6517, Separability ratio = 1.7305
# Layer 21: Inter-class distance = 32.7104, Intra-class distance = 18.8981, Separability ratio = 1.7309
# Layer 22: Inter-class distance = 34.2348, Intra-class distance = 19.8908, Separability ratio = 1.7211
# Layer 23: Inter-class distance = 35.8449, Intra-class distance = 20.8772, Separability ratio = 1.7169
# Layer 24: Inter-class distance = 37.3607, Intra-class distance = 22.3964, Separability ratio = 1.6682
# Layer 25: Inter-class distance = 39.7051, Intra-class distance = 23.8772, Separability ratio = 1.6629
# Layer 26: Inter-class distance = 41.9752, Intra-class distance = 25.5357, Separability ratio = 1.6438
# Layer 27: Inter-class distance = 45.2308, Intra-class distance = 26.9586, Separability ratio = 1.6778
# Layer 28: Inter-class distance = 47.7495, Intra-class distance = 28.8299, Separability ratio = 1.6562
# Layer 29: Inter-class distance = 51.1183, Intra-class distance = 31.0016, Separability ratio = 1.6489
# Layer 30: Inter-class distance = 56.3691, Intra-class distance = 33.8278, Separability ratio = 1.6664
# Layer 31: Inter-class distance = 53.9350, Intra-class distance = 35.8371, Separability ratio = 1.5050
# """

after_ft_hr_0 = """
Layer 0: Inter-class distance = 0.1786, Intra-class distance = 0.1965, Separability ratio = 0.9086
Layer 1: Inter-class distance = 0.3076, Intra-class distance = 0.3221, Separability ratio = 0.9550
Layer 2: Inter-class distance = 0.4969, Intra-class distance = 0.5369, Separability ratio = 0.9255
Layer 3: Inter-class distance = 1.2621, Intra-class distance = 1.1387, Separability ratio = 1.1083
Layer 4: Inter-class distance = 1.5065, Intra-class distance = 1.3923, Separability ratio = 1.0820
Layer 5: Inter-class distance = 1.9104, Intra-class distance = 1.8144, Separability ratio = 1.0529
Layer 6: Inter-class distance = 2.3639, Intra-class distance = 2.4359, Separability ratio = 0.9704
Layer 7: Inter-class distance = 2.8151, Intra-class distance = 2.9099, Separability ratio = 0.9674
Layer 8: Inter-class distance = 3.5807, Intra-class distance = 3.3759, Separability ratio = 1.0607
Layer 9: Inter-class distance = 5.0978, Intra-class distance = 5.0720, Separability ratio = 1.0051
Layer 10: Inter-class distance = 6.0514, Intra-class distance = 5.5193, Separability ratio = 1.0964
Layer 11: Inter-class distance = 7.4192, Intra-class distance = 6.6112, Separability ratio = 1.1222
Layer 12: Inter-class distance = 10.2274, Intra-class distance = 8.0536, Separability ratio = 1.2699
Layer 13: Inter-class distance = 15.3403, Intra-class distance = 9.5993, Separability ratio = 1.5981
Layer 14: Inter-class distance = 18.0984, Intra-class distance = 11.7104, Separability ratio = 1.5455
Layer 15: Inter-class distance = 22.0913, Intra-class distance = 13.7139, Separability ratio = 1.6109
Layer 16: Inter-class distance = 24.5514, Intra-class distance = 16.4003, Separability ratio = 1.4970
Layer 17: Inter-class distance = 26.8497, Intra-class distance = 18.3822, Separability ratio = 1.4606
Layer 18: Inter-class distance = 30.0466, Intra-class distance = 21.4610, Separability ratio = 1.4001
Layer 19: Inter-class distance = 32.4110, Intra-class distance = 23.8317, Separability ratio = 1.3600
Layer 20: Inter-class distance = 36.1442, Intra-class distance = 26.9567, Separability ratio = 1.3408
Layer 21: Inter-class distance = 40.9007, Intra-class distance = 30.4955, Separability ratio = 1.3412
Layer 22: Inter-class distance = 43.6439, Intra-class distance = 33.5217, Separability ratio = 1.3020
Layer 23: Inter-class distance = 45.3604, Intra-class distance = 35.5808, Separability ratio = 1.2749
Layer 24: Inter-class distance = 47.1405, Intra-class distance = 39.0667, Separability ratio = 1.2067
Layer 25: Inter-class distance = 51.0631, Intra-class distance = 42.1698, Separability ratio = 1.2109
Layer 26: Inter-class distance = 54.6740, Intra-class distance = 46.0768, Separability ratio = 1.1866
Layer 27: Inter-class distance = 60.3451, Intra-class distance = 49.4148, Separability ratio = 1.2212
Layer 28: Inter-class distance = 64.2024, Intra-class distance = 53.5914, Separability ratio = 1.1980
Layer 29: Inter-class distance = 67.1362, Intra-class distance = 58.0921, Separability ratio = 1.1557
Layer 30: Inter-class distance = 73.8528, Intra-class distance = 64.8995, Separability ratio = 1.1380
Layer 31: Inter-class distance = 62.4459, Intra-class distance = 59.7269, Separability ratio = 1.0455
"""

after_ft_hr_005 = """
Layer 0: Inter-class distance = 0.1817, Intra-class distance = 0.1971, Separability ratio = 0.9217
Layer 1: Inter-class distance = 0.3213, Intra-class distance = 0.3277, Separability ratio = 0.9805
Layer 2: Inter-class distance = 0.5374, Intra-class distance = 0.5838, Separability ratio = 0.9206
Layer 3: Inter-class distance = 1.2667, Intra-class distance = 1.1385, Separability ratio = 1.1126
Layer 4: Inter-class distance = 1.4711, Intra-class distance = 1.3472, Separability ratio = 1.0919
Layer 5: Inter-class distance = 1.8819, Intra-class distance = 1.7607, Separability ratio = 1.0689
Layer 6: Inter-class distance = 2.3867, Intra-class distance = 2.4564, Separability ratio = 0.9716
Layer 7: Inter-class distance = 2.8598, Intra-class distance = 2.9629, Separability ratio = 0.9652
Layer 8: Inter-class distance = 3.5243, Intra-class distance = 3.4248, Separability ratio = 1.0290
Layer 9: Inter-class distance = 4.8779, Intra-class distance = 5.1678, Separability ratio = 0.9439
Layer 10: Inter-class distance = 5.6005, Intra-class distance = 5.7072, Separability ratio = 0.9813
Layer 11: Inter-class distance = 6.4808, Intra-class distance = 6.6099, Separability ratio = 0.9805
Layer 12: Inter-class distance = 7.7654, Intra-class distance = 7.8875, Separability ratio = 0.9845
Layer 13: Inter-class distance = 9.8116, Intra-class distance = 9.3946, Separability ratio = 1.0444
Layer 14: Inter-class distance = 11.9279, Intra-class distance = 11.8538, Separability ratio = 1.0063
Layer 15: Inter-class distance = 16.5669, Intra-class distance = 14.5295, Separability ratio = 1.1402
Layer 16: Inter-class distance = 21.4801, Intra-class distance = 18.1874, Separability ratio = 1.1810
Layer 17: Inter-class distance = 23.3204, Intra-class distance = 20.6575, Separability ratio = 1.1289
Layer 18: Inter-class distance = 26.5064, Intra-class distance = 24.4123, Separability ratio = 1.0858
Layer 19: Inter-class distance = 28.7526, Intra-class distance = 27.2209, Separability ratio = 1.0563
Layer 20: Inter-class distance = 32.0594, Intra-class distance = 30.9013, Separability ratio = 1.0375
Layer 21: Inter-class distance = 36.9215, Intra-class distance = 35.1400, Separability ratio = 1.0507
Layer 22: Inter-class distance = 38.7829, Intra-class distance = 38.4775, Separability ratio = 1.0079
Layer 23: Inter-class distance = 39.9972, Intra-class distance = 40.7193, Separability ratio = 0.9823
Layer 24: Inter-class distance = 42.8953, Intra-class distance = 44.6980, Separability ratio = 0.9597
Layer 25: Inter-class distance = 47.4953, Intra-class distance = 48.4579, Separability ratio = 0.9801
Layer 26: Inter-class distance = 50.8832, Intra-class distance = 52.9135, Separability ratio = 0.9616
Layer 27: Inter-class distance = 56.7458, Intra-class distance = 56.9667, Separability ratio = 0.9961
Layer 28: Inter-class distance = 61.1981, Intra-class distance = 61.6549, Separability ratio = 0.9926
Layer 29: Inter-class distance = 65.2445, Intra-class distance = 67.0968, Separability ratio = 0.9724
Layer 30: Inter-class distance = 72.3882, Intra-class distance = 75.1169, Separability ratio = 0.9637
Layer 31: Inter-class distance = 61.5604, Intra-class distance = 63.1960, Separability ratio = 0.9741
"""

before_ft = """
Layer 0: Inter-class distance = 0.1719, Intra-class distance = 0.1909, Separability ratio = 0.9002
Layer 1: Inter-class distance = 0.3054, Intra-class distance = 0.3149, Separability ratio = 0.9699
Layer 2: Inter-class distance = 0.5224, Intra-class distance = 0.5491, Separability ratio = 0.9514
Layer 3: Inter-class distance = 1.0727, Intra-class distance = 1.0162, Separability ratio = 1.0556
Layer 4: Inter-class distance = 1.3352, Intra-class distance = 1.3232, Separability ratio = 1.0091
Layer 5: Inter-class distance = 1.9044, Intra-class distance = 1.9268, Separability ratio = 0.9884
Layer 6: Inter-class distance = 2.0753, Intra-class distance = 2.1240, Separability ratio = 0.9771
Layer 7: Inter-class distance = 2.5341, Intra-class distance = 2.5689, Separability ratio = 0.9865
Layer 8: Inter-class distance = 2.9784, Intra-class distance = 2.8495, Separability ratio = 1.0452
Layer 9: Inter-class distance = 5.5770, Intra-class distance = 4.2288, Separability ratio = 1.3188
Layer 10: Inter-class distance = 8.3581, Intra-class distance = 5.0240, Separability ratio = 1.6637
Layer 11: Inter-class distance = 11.2392, Intra-class distance = 5.8619, Separability ratio = 1.9173
Layer 12: Inter-class distance = 14.8679, Intra-class distance = 6.8449, Separability ratio = 2.1721
Layer 13: Inter-class distance = 20.0499, Intra-class distance = 8.0283, Separability ratio = 2.4974
Layer 14: Inter-class distance = 20.5927, Intra-class distance = 8.7456, Separability ratio = 2.3546
Layer 15: Inter-class distance = 21.7923, Intra-class distance = 9.2789, Separability ratio = 2.3486
Layer 16: Inter-class distance = 23.8853, Intra-class distance = 10.4228, Separability ratio = 2.2916
Layer 17: Inter-class distance = 24.9753, Intra-class distance = 10.8253, Separability ratio = 2.3071
Layer 18: Inter-class distance = 27.0161, Intra-class distance = 11.8518, Separability ratio = 2.2795
Layer 19: Inter-class distance = 29.5816, Intra-class distance = 12.8729, Separability ratio = 2.2980
Layer 20: Inter-class distance = 33.0684, Intra-class distance = 14.0993, Separability ratio = 2.3454
Layer 21: Inter-class distance = 35.9712, Intra-class distance = 15.3640, Separability ratio = 2.3413
Layer 22: Inter-class distance = 39.3768, Intra-class distance = 16.5822, Separability ratio = 2.3746
Layer 23: Inter-class distance = 41.8124, Intra-class distance = 17.7883, Separability ratio = 2.3506
Layer 24: Inter-class distance = 44.5032, Intra-class distance = 19.1597, Separability ratio = 2.3228
Layer 25: Inter-class distance = 47.6948, Intra-class distance = 20.6866, Separability ratio = 2.3056
Layer 26: Inter-class distance = 50.8554, Intra-class distance = 22.3604, Separability ratio = 2.2744
Layer 27: Inter-class distance = 54.1041, Intra-class distance = 23.9048, Separability ratio = 2.2633
Layer 28: Inter-class distance = 56.7077, Intra-class distance = 25.7885, Separability ratio = 2.1990
Layer 29: Inter-class distance = 60.2222, Intra-class distance = 27.6453, Separability ratio = 2.1784
Layer 30: Inter-class distance = 63.9189, Intra-class distance = 29.8909, Separability ratio = 2.1384
Layer 31: Inter-class distance = 86.2276, Intra-class distance = 42.9127, Separability ratio = 2.0094
"""

rate_pre = [0.0, 0.0, 0.0, 0.0, 0.0, 4.38, 11.68, 5.86, 3.65, 8.03, 1.46, 2.19, 24.82, 67.88, 88.32, 96.62, 100.00]
rate_ft00 = [3.07, 5.84, 20.44, 15.33, 13.14, 16.79, 39.42, 44.33, 46.39, 33.58, 26.28, 28.17, 47.23, 67.23, 82.48, 91.24, 97.08, 99.27, 98.54, 100]
rate_ft005 = [40.38, 57.66, 81.75, 83.94, 83.94, 82.48, 91.24, 94.16, 97.08, 95.62, 95.62, 95.62, 96.35, 93.43, 100]

rate_pre = rate_pre + [100.0] * (32 - len(rate_pre))
rate_ft00 = rate_ft00 + [100.0] * (32 - len(rate_ft00))
rate_ft005 = rate_ft005 + [100.0] * (32 - len(rate_ft005))

rate_pre = rate_pre[::-1]
rate_ft00 = rate_ft00[::-1]
rate_ft005 = rate_ft005[::-1]

rate_pre = [100 - each for each in rate_pre]
rate_ft00 = [100 - each for each in rate_ft00]
rate_ft005 = [100 - each for each in rate_ft005]

import matplotlib.pyplot as plt
plt.figure(figsize=(6, 4))
layers = list(range(1, 33))
# -', '--', '-.', ':', 'None', ' ', '', 'solid', 'dashed', 'dashdot', 'dotted'
plt.plot(
    layers, rate_pre,
    label='Before SFT',
    linestyle='solid',
    linewidth=2.5,
    color='#1f4ed8',
    alpha=0.8,
)

plt.plot(
    layers, rate_ft00,
    label='After SFT (hr=0.0)',
    linestyle='--',
    linewidth=2.5,
    color='#b91c1c',
alpha=0.95,
)

plt.plot(
    layers, rate_ft005,
    label='After SFT (hr=0.05)',
    linestyle='-.',
    linewidth=2.5,
    color='#166534',
alpha=0.95,
)
plt.xlabel('Layer', fontsize=13, fontweight='bold')
plt.ylabel('Rejection Rate(%)', fontsize=13, fontweight='bold')
plt.legend(fontsize=13, prop={'weight': 'bold'})
plt.xlim(xmin=0)
plt.savefig('rejection_rate_plot.jpg', dpi=300, bbox_inches='tight')
plt.show()

import re


# 提取Separability ratio = 后面的数字
def extract_separability_ratios(text):
    pattern = r"Separability ratio = ([\d.]+)"
    ratios = re.findall(pattern, text)
    return [float(ratio) for ratio in ratios]


ft_0 = extract_separability_ratios(after_ft_hr_0)
ft_005 = extract_separability_ratios(after_ft_hr_005)
pre = extract_separability_ratios(before_ft)

import matplotlib.pyplot as plt
plt.figure(figsize=(6, 4))
layers = list(range(1, len(ft_0) + 1))
plt.plot(layers, pre, label='Before SFT', linestyle='solid', alpha=0.8, linewidth=2.5,
    color='#1f4ed8',
)
plt.plot(layers, ft_0, label='After SFT (hr=0.0)', linestyle='--', linewidth=2.5,
    color='#b91c1c',
alpha=0.95,)
plt.plot(layers, ft_005, label='After SFT (hr=0.05)', linestyle='-.', linewidth=2.5,
    color='#166534',
alpha=0.95,)
plt.xlabel('Layer', fontsize=13, fontweight='bold')
plt.ylabel('Separability Ratio', fontsize=13, fontweight='bold')
plt.legend(fontsize=13, prop={'weight': 'bold'})
plt.xlim(xmin=0)
plt.savefig('separability_ratio_plot.jpg', dpi=300, bbox_inches='tight')
plt.show()

# import matplotlib.pyplot as plt
#
#
# accuracy = [[94.15, 94.04, 93.35, 93.58, 94.11], [94.50, 93.92, 93.23, 94.20, 94.40], [94.38, 92.89, 93.58, 93.83, 94.05]]
# harmful = [[51.0, 26.8, 16.7, 11.1, 3.9], [53.0, 36.5, 13.6, 9.8, 4.3], [53.1, 43.3, 14.2, 11.3, 4.4]]
# baselines = ['SFT', 'LiSA', 'PTST', 'Panacea', 'Ours']
# hamrful_rate = [0.1, 0.15]
# scatter_shape = ['o', 's', '^', 'D', 'v']
#
# num = len(accuracy[0])
#
# for j in range(len(hamrful_rate)):
#     for i in range(num):
#         if j == 0:
#             plt.scatter(harmful[j][i], accuracy[j][i], label=baselines[i], marker=scatter_shape[i], s=100)
#         else:
#             plt.scatter(harmful[j][i], accuracy[j][i], marker=scatter_shape[i], s=100)
#
# plt.ylabel('Accuracy')
# plt.xlabel('Harmful Output Rate')
# plt.legend()
#
# plt.show()
